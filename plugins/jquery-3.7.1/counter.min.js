$(document).ready(function() {
  function animateCounters() {
    $('.counter_count span').each(function() {
      var $this = $(this);
      var countTo = $this.attr('data-num');
      var delayTo = $this.attr('delay');

      if (!delayTo) {
        delayTo = 2000;
      }

      $({
        countNum: $this.text()
      }).animate({
        countNum: countTo
      }, {
        duration: delayTo,
        easing: 'linear',
        step: function() {
          $this.text(Math.floor(this.countNum));
        },
        complete: function() {
          $this.text(this.countNum);
        }
      });
    });
  }

  function isElementInViewport(el) {
    var rect = el.getBoundingClientRect();
    return (
      rect.top >= 0 &&
      rect.left >= 0 &&
      rect.bottom <= (window.innerHeight || document.documentElement.clientHeight) &&
      rect.right <= (window.innerWidth || document.documentElement.clientWidth)
    );
  }

  $(window).on('scroll', function() {
    if (isElementInViewport(document.querySelector('.counter_count'))) {
      animateCounters();
      $(window).off('scroll');
    }
  });

  // Trigger scroll event on page load in case the element is already in viewport
  $(window).trigger('scroll');
});
